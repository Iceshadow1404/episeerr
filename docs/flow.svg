<svg viewBox="0 0 1200 800" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <path d="M0,0 L0,6 L9,3 z" fill="#333"/>
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="600" y="30" text-anchor="middle" font-size="20" font-weight="bold" fill="#1f2937">Episeerr System Flow</text>
  
  <!-- Existing Series -->
  <rect x="50" y="70" width="120" height="40" fill="#d1fae5" stroke="#10b981" stroke-width="2" rx="5"/>
  <text x="110" y="95" text-anchor="middle" font-size="12" fill="#374151">Existing Series</text>
  
  <!-- Has Rule Decision -->
  <polygon points="220,90 270,70 320,90 270,110" fill="#fed7d7" stroke="#ef4444" stroke-width="2"/>
  <text x="270" y="95" text-anchor="middle" font-size="11" fill="#374151">Has Rule?</text>
  
  <!-- No Rule -->
  <rect x="370" y="70" width="100" height="30" fill="#f3f4f6" stroke="#6b7280" stroke-width="2" rx="5"/>
  <text x="420" y="90" text-anchor="middle" font-size="11" fill="#374151">Episeerr Ignores</text>
  
  <!-- Rule Processing -->
  <rect x="220" y="140" width="120" height="40" fill="#dbeafe" stroke="#3b82f6" stroke-width="2" rx="5"/>
  <text x="280" y="165" text-anchor="middle" font-size="12" fill="#374151">Rule Assigned</text>
  
  <!-- User Watches Episode -->
  <rect x="50" y="220" width="120" height="40" fill="#fef3c7" stroke="#f59e0b" stroke-width="2" rx="5"/>
  <text x="110" y="245" text-anchor="middle" font-size="11" fill="#374151">User Watches Episode</text>
  
  <!-- Calculate Keep Block -->
  <rect x="50" y="290" width="120" height="40" fill="#dbeafe" stroke="#3b82f6" stroke-width="2" rx="5"/>
  <text x="110" y="315" text-anchor="middle" font-size="11" fill="#374151">Calculate Keep Block</text>
  
  <!-- Get Next Episodes -->
  <rect x="220" y="220" width="100" height="30" fill="#dbeafe" stroke="#3b82f6" stroke-width="2" rx="5"/>
  <text x="270" y="240" text-anchor="middle" font-size="10" fill="#374151">Get Next Episodes</text>
  
  <!-- Keep Episodes -->
  <rect x="220" y="270" width="100" height="30" fill="#dcfce7" stroke="#16a34a" stroke-width="2" rx="5"/>
  <text x="270" y="290" text-anchor="middle" font-size="10" fill="#374151">Keep Last N Episodes</text>
  
  <!-- Delete Episodes -->
  <rect x="220" y="320" width="100" height="30" fill="#fee2e2" stroke="#dc2626" stroke-width="2" rx="5"/>
  <text x="270" y="340" text-anchor="middle" font-size="10" fill="#374151">Delete Before Keep</text>
  
  <!-- Grace Period Check -->
  <polygon points="380,335 430,315 480,335 430,355" fill="#fed7d7" stroke="#ef4444" stroke-width="2"/>
  <text x="430" y="340" text-anchor="middle" font-size="10" fill="#374151">Grace Period?</text>
  
  <!-- Delete Now -->
  <rect x="520" y="315" width="80" height="30" fill="#dcfce7" stroke="#16a34a" stroke-width="2" rx="5"/>
  <text x="560" y="335" text-anchor="middle" font-size="10" fill="#374151">Delete Now</text>
  
  <!-- Recycle Bin -->
  <rect x="380" y="380" width="100" height="40" fill="#fce7f3" stroke="#ec4899" stroke-width="2" rx="5"/>
  <text x="430" y="395" text-anchor="middle" font-size="9" fill="#374151">add_episodes_to</text>
  <text x="430" y="408" text-anchor="middle" font-size="9" fill="#374151">_recycle_bin</text>
  
  <!-- Dormant Check -->
  <rect x="500" y="220" width="120" height="40" fill="#dbeafe" stroke="#3b82f6" stroke-width="2" rx="5"/>
  <text x="560" y="245" text-anchor="middle" font-size="11" fill="#374151">Dormant Check</text>
  
  <!-- Has Dormant Setting -->
  <polygon points="650,245 700,225 750,245 700,265" fill="#fed7d7" stroke="#ef4444" stroke-width="2"/>
  <text x="700" y="250" text-anchor="middle" font-size="10" fill="#374151">Has Dormant?</text>
  
  <!-- Do Nothing -->
  <rect x="780" y="200" width="80" height="30" fill="#f3f4f6" stroke="#6b7280" stroke-width="2" rx="5"/>
  <text x="820" y="220" text-anchor="middle" font-size="10" fill="#374151">Do Nothing</text>
  
  <!-- Storage Gate -->
  <polygon points="780,270 830,250 880,270 830,290" fill="#fed7d7" stroke="#ef4444" stroke-width="2"/>
  <text x="830" y="275" text-anchor="middle" font-size="9" fill="#374151">Storage Gate?</text>
  
  <!-- Delete All -->
  <rect x="910" y="250" width="80" height="30" fill="#dcfce7" stroke="#16a34a" stroke-width="2" rx="5"/>
  <text x="950" y="270" text-anchor="middle" font-size="10" fill="#374151">Delete All</text>
  
  <!-- Protected -->
  <rect x="780" y="320" width="80" height="30" fill="#f0fdf4" stroke="#22c55e" stroke-width="2" rx="5"/>
  <text x="820" y="340" text-anchor="middle" font-size="10" fill="#374151">Protected</text>
  
  <!-- Dry Run Mode Box -->
  <rect x="520" y="440" width="140" height="40" fill="#ede9fe" stroke="#8b5cf6" stroke-width="3" rx="5"/>
  <text x="590" y="460" text-anchor="middle" font-size="11" font-weight="bold" fill="#374151">DRY RUN MODE</text>
  <text x="590" y="475" text-anchor="middle" font-size="10" fill="#374151">Blocks All Deletions</text>
  
  <!-- Recycle Bin Cleanup -->
  <rect x="100" y="480" width="150" height="40" fill="#ede9fe" stroke="#8b5cf6" stroke-width="2" rx="5"/>
  <text x="175" y="495" text-anchor="middle" font-size="11" fill="#374151">run_recycle_bin_cleanup</text>
  <text x="175" y="510" text-anchor="middle" font-size="10" fill="#374151">Scheduled Function</text>
  
  <!-- Permanent Delete -->
  <rect x="300" y="480" width="120" height="40" fill="#dc2626" stroke="#dc2626" stroke-width="2" rx="5"/>
  <text x="360" y="495" text-anchor="middle" font-size="10" fill="white">check_recycle_bin_expiry</text>
  <text x="360" y="510" text-anchor="middle" font-size="10" fill="white">Permanent Delete</text>
  
  <!-- Request Apps -->
  <rect x="50" y="580" width="120" height="40" fill="#fef3c7" stroke="#f59e0b" stroke-width="2" rx="5"/>
  <text x="110" y="605" text-anchor="middle" font-size="11" fill="#374151">Request Apps</text>
  
  <!-- Has Tag -->
  <polygon points="220,600 270,580 320,600 270,620" fill="#fed7d7" stroke="#ef4444" stroke-width="2"/>
  <text x="270" y="605" text-anchor="middle" font-size="10" fill="#374151">Has Tag?</text>
  
  <!-- Normal Sonarr -->
  <rect x="370" y="580" width="100" height="30" fill="#f3f4f6" stroke="#6b7280" stroke-width="2" rx="5"/>
  <text x="420" y="600" text-anchor="middle" font-size="10" fill="#374151">Normal Sonarr</text>
  
  <!-- Episode Selection -->
  <rect x="200" y="650" width="120" height="30" fill="#fde68a" stroke="#d97706" stroke-width="2" rx="5"/>
  <text x="260" y="670" text-anchor="middle" font-size="10" fill="#374151">Episode Selection</text>
  
  <!-- Send to Sonarr -->
  <rect x="350" y="650" width="100" height="30" fill="#fde68a" stroke="#d97706" stroke-width="2" rx="5"/>
  <text x="400" y="670" text-anchor="middle" font-size="10" fill="#374151">Send to Sonarr</text>
  
  <!-- Back to Series -->
  <rect x="480" y="650" width="100" height="30" fill="#d1fae5" stroke="#10b981" stroke-width="2" rx="5"/>
  <text x="530" y="670" text-anchor="middle" font-size="10" fill="#374151">Back to Series</text>
  
  <!-- Arrows -->
  <line x1="170" y1="90" x2="220" y2="90" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="320" y1="85" x2="370" y2="85" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="270" y1="110" x2="270" y2="140" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  
  <!-- Split paths -->
  <line x1="220" y1="160" x2="110" y2="160" stroke="#333" stroke-width="2"/>
  <line x1="110" y1="160" x2="110" y2="220" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="340" y1="160" x2="560" y2="160" stroke="#333" stroke-width="2"/>
  <line x1="560" y1="160" x2="560" y2="220" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  
  <!-- User watches flow -->
  <line x1="110" y1="260" x2="110" y2="290" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="170" y1="240" x2="220" y2="240" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="170" y1="310" x2="220" y2="285" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="170" y1="310" x2="220" y2="335" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="320" y1="335" x2="380" y2="335" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="480" y1="325" x2="520" y2="325" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="430" y1="355" x2="430" y2="380" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  
  <!-- Dry run short circuits -->
  <line x1="520" y1="460" x2="430" y2="460" stroke="#8b5cf6" stroke-width="3" stroke-dasharray="5,5"/>
  <line x1="430" y1="460" x2="430" y2="410" stroke="#8b5cf6" stroke-width="3" stroke-dasharray="5,5" marker-end="url(#arrow)"/>
  <line x1="520" y1="460" x2="350" y2="460" stroke="#8b5cf6" stroke-width="3" stroke-dasharray="5,5"/>
  <line x1="350" y1="460" x2="350" y2="520" stroke="#8b5cf6" stroke-width="3" stroke-dasharray="5,5" marker-end="url(#arrow)"/>
  <line x1="660" y1="460" x2="950" y2="460" stroke="#8b5cf6" stroke-width="3" stroke-dasharray="5,5"/>
  <line x1="950" y1="460" x2="950" y2="280" stroke="#8b5cf6" stroke-width="3" stroke-dasharray="5,5" marker-end="url(#arrow)"/>
  
  <!-- Dormant flow -->
  <line x1="620" y1="245" x2="650" y2="245" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="750" y1="235" x2="780" y2="215" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="700" y1="265" x2="700" y2="275" stroke="#333" stroke-width="2"/>
  <line x1="700" y1="275" x2="780" y2="275" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="880" y1="265" x2="910" y2="265" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="830" y1="290" x2="830" y2="320" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  
  <!-- Recycle bin cleanup -->
  <line x1="250" y1="500" x2="300" y2="500" stroke="#8b5cf6" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrow)"/>
  
  <!-- Connection from recycle bin to cleanup -->
  <line x1="430" y1="420" x2="430" y2="440" stroke="#ec4899" stroke-width="2" stroke-dasharray="3,3"/>
  <line x1="430" y1="440" x2="175" y2="440" stroke="#ec4899" stroke-width="2" stroke-dasharray="3,3"/>
  <line x1="175" y1="440" x2="175" y2="480" stroke="#ec4899" stroke-width="2" stroke-dasharray="3,3" marker-end="url(#arrow)"/>
  
  <!-- Request flow -->
  <line x1="170" y1="600" x2="220" y2="600" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="320" y1="595" x2="370" y2="595" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="240" y1="620" x2="240" y2="640" stroke="#333" stroke-width="2"/>
  <line x1="240" y1="640" x2="260" y2="650" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="300" y1="620" x2="300" y2="640" stroke="#333" stroke-width="2"/>
  <line x1="300" y1="640" x2="400" y2="650" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  <line x1="450" y1="665" x2="480" y2="665" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  
  <!-- Feedback loop -->
  <line x1="530" y1="650" x2="530" y2="630" stroke="#333" stroke-width="2"/>
  <line x1="530" y1="630" x2="1100" y2="630" stroke="#333" stroke-width="2"/>
  <line x1="1100" y1="630" x2="1100" y2="90" stroke="#333" stroke-width="2"/>
  <line x1="1100" y1="90" x2="170" y2="90" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
  
  <!-- Labels -->
  <text x="340" y="80" font-size="10" fill="#ef4444">No</text>
  <text x="285" y="125" font-size="10" fill="#059669">Yes</text>
  <text x="500" y="320" font-size="10" fill="#ef4444">No</text>
  <text x="445" y="365" font-size="10" fill="#059669">Yes</text>
  <text x="770" y="210" font-size="10" fill="#ef4444">No</text>
  <text x="715" y="235" font-size="10" fill="#059669">Yes</text>
  <text x="895" y="260" font-size="10" fill="#ef4444">Below</text>
  <text x="845" y="310" font-size="10" fill="#059669">Above</text>
  <text x="390" y="590" font-size="10" fill="#ef4444">No</text>
  <text x="230" y="635" font-size="9" fill="#d97706">default</text>
  <text x="320" y="635" font-size="9" fill="#d97706">select</text>
  
  <!-- Section divider -->
  <line x1="30" y1="560" x2="1170" y2="560" stroke="#e5e7eb" stroke-width="2" stroke-dasharray="5,5"/>
  <text x="30" y="555" font-size="12" fill="#6b7280">Request System</text>
</svg>